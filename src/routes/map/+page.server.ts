import type { PageLoad } from './$types';

export const load: PageLoad = async ({ url }) => {
	let lat = url.searchParams.get('lat') || 21.171814;
	let lon = url.searchParams.get('lon') || 72.817699;
	// console.log(latitude, lon);
	// let latitude = 21.171814;
	// let lon = 72.817699;

	const response = await fetch(
		'https://us-central1-womensafety-422010.cloudfunctions.net/predict',
		{
			method: 'POST',
			body: JSON.stringify({
				latitude: lat,
				longitude: lon
			})
		}
	);
	const predictedData = await response.json();
	let swappedArea = [];
	let swappedState = [];
	const resp = await fetch(`https://nirbhicapi.netlify.app/?lat=${lat}&lon=${lon}`);

	const coordinates = await resp.json();
	if (!coordinates) {
		return {
			stateData: [],
			coordata: [],
			predictedData: []
		};
	}
	const { currentArea, currentState } = coordinates;
	for (let i = 0; i < currentArea[0].length; i++) {
		swappedArea = currentArea[0].map(([lat, lon]) => [lon, lat]);
	}

	swappedState = currentState.map((innerArray) =>
		innerArray.map((dinner) => dinner.map(([lat, lon]) => [lon, lat]))
	);
	// console.log(currentState[0][0]);
	console.log('==================================================================');

	// console.log(swappedState[0][0]);

	// console.log(predictedData);
	// const a = await fetch('https://bxdwqjsk-8000.inc1.devtunnels.ms/predict', {
	// 	method: 'POST',
	// 	body: JSON.stringify({
	// 		coord: [
	// 			{
	// 				lat: 21.17002,
	// 				lng: 72.81
	// 			},
	// 			{
	// 				lat: 21.17006,
	// 				lng: 72.81026
	// 			},
	// 			{
	// 				lat: 21.1701,
	// 				lng: 72.81048
	// 			},
	// 			{
	// 				lat: 21.1701,
	// 				lng: 72.81048
	// 			},
	// 			{
	// 				lat: 21.1696,
	// 				lng: 72.81054
	// 			},
	// 			{
	// 				lat: 21.1696,
	// 				lng: 72.81054
	// 			},
	// 			{
	// 				lat: 21.16971,
	// 				lng: 72.81101
	// 			},
	// 			{
	// 				lat: 21.16986,
	// 				lng: 72.81155
	// 			},
	// 			{
	// 				lat: 21.16986,
	// 				lng: 72.81155
	// 			},
	// 			{
	// 				lat: 21.16989,
	// 				lng: 72.81165
	// 			},
	// 			{
	// 				lat: 21.1698,
	// 				lng: 72.81167
	// 			},
	// 			{
	// 				lat: 21.16971,
	// 				lng: 72.81167
	// 			},
	// 			{
	// 				lat: 21.16962,
	// 				lng: 72.81168
	// 			},
	// 			{
	// 				lat: 21.16947,
	// 				lng: 72.8117
	// 			},
	// 			{
	// 				lat: 21.16915,
	// 				lng: 72.81175
	// 			},
	// 			{
	// 				lat: 21.16898,
	// 				lng: 72.81177
	// 			},
	// 			{
	// 				lat: 21.16826,
	// 				lng: 72.81185
	// 			},
	// 			{
	// 				lat: 21.16809,
	// 				lng: 72.81188
	// 			},
	// 			{
	// 				lat: 21.16749,
	// 				lng: 72.81196
	// 			},
	// 			{
	// 				lat: 21.1668,
	// 				lng: 72.81206
	// 			},
	// 			{
	// 				lat: 21.16649,
	// 				lng: 72.81209
	// 			},
	// 			{
	// 				lat: 21.16617,
	// 				lng: 72.81211
	// 			},
	// 			{
	// 				lat: 21.1656,
	// 				lng: 72.81216
	// 			},
	// 			{
	// 				lat: 21.16537,
	// 				lng: 72.81219
	// 			},
	// 			{
	// 				lat: 21.16514,
	// 				lng: 72.81222
	// 			},
	// 			{
	// 				lat: 21.16413,
	// 				lng: 72.81237
	// 			},
	// 			{
	// 				lat: 21.16386,
	// 				lng: 72.81255
	// 			},
	// 			{
	// 				lat: 21.16386,
	// 				lng: 72.81255
	// 			},
	// 			{
	// 				lat: 21.1638,
	// 				lng: 72.81261
	// 			},
	// 			{
	// 				lat: 21.16377,
	// 				lng: 72.8126
	// 			},
	// 			{
	// 				lat: 21.1637,
	// 				lng: 72.81257
	// 			},
	// 			{
	// 				lat: 21.16345,
	// 				lng: 72.81247
	// 			},
	// 			{
	// 				lat: 21.16342,
	// 				lng: 72.81246
	// 			},
	// 			{
	// 				lat: 21.16308,
	// 				lng: 72.81237
	// 			},
	// 			{
	// 				lat: 21.16268,
	// 				lng: 72.81238
	// 			},
	// 			{
	// 				lat: 21.16268,
	// 				lng: 72.81238
	// 			},
	// 			{
	// 				lat: 21.16264,
	// 				lng: 72.81208
	// 			},
	// 			{
	// 				lat: 21.16264,
	// 				lng: 72.81208
	// 			},
	// 			{
	// 				lat: 21.1623,
	// 				lng: 72.81195
	// 			},
	// 			{
	// 				lat: 21.16174,
	// 				lng: 72.81169
	// 			},
	// 			{
	// 				lat: 21.16093,
	// 				lng: 72.81131
	// 			},
	// 			{
	// 				lat: 21.16066,
	// 				lng: 72.81118
	// 			},
	// 			{
	// 				lat: 21.16049,
	// 				lng: 72.81114
	// 			},
	// 			{
	// 				lat: 21.16038,
	// 				lng: 72.81113
	// 			},
	// 			{
	// 				lat: 21.16031,
	// 				lng: 72.81112
	// 			},
	// 			{
	// 				lat: 21.16026,
	// 				lng: 72.81112
	// 			},
	// 			{
	// 				lat: 21.16026,
	// 				lng: 72.81112
	// 			},
	// 			{
	// 				lat: 21.16021,
	// 				lng: 72.8111
	// 			},
	// 			{
	// 				lat: 21.16017,
	// 				lng: 72.81106
	// 			},
	// 			{
	// 				lat: 21.16015,
	// 				lng: 72.81101
	// 			},
	// 			{
	// 				lat: 21.16014,
	// 				lng: 72.81096
	// 			},
	// 			{
	// 				lat: 21.16015,
	// 				lng: 72.81091
	// 			},
	// 			{
	// 				lat: 21.16017,
	// 				lng: 72.81086
	// 			},
	// 			{
	// 				lat: 21.1602,
	// 				lng: 72.81083
	// 			},
	// 			{
	// 				lat: 21.1601,
	// 				lng: 72.81073
	// 			},
	// 			{
	// 				lat: 21.15999,
	// 				lng: 72.81066
	// 			},
	// 			{
	// 				lat: 21.15992,
	// 				lng: 72.81061
	// 			},
	// 			{
	// 				lat: 21.15889,
	// 				lng: 72.80985
	// 			},
	// 			{
	// 				lat: 21.15862,
	// 				lng: 72.80968
	// 			},
	// 			{
	// 				lat: 21.15855,
	// 				lng: 72.80964
	// 			},
	// 			{
	// 				lat: 21.15841,
	// 				lng: 72.80958
	// 			},
	// 			{
	// 				lat: 21.15825,
	// 				lng: 72.80952
	// 			},
	// 			{
	// 				lat: 21.15818,
	// 				lng: 72.80951
	// 			},
	// 			{
	// 				lat: 21.15807,
	// 				lng: 72.80948
	// 			},
	// 			{
	// 				lat: 21.15789,
	// 				lng: 72.80946
	// 			},
	// 			{
	// 				lat: 21.15784,
	// 				lng: 72.80945
	// 			},
	// 			{
	// 				lat: 21.15755,
	// 				lng: 72.80944
	// 			},
	// 			{
	// 				lat: 21.15737,
	// 				lng: 72.80944
	// 			},
	// 			{
	// 				lat: 21.15716,
	// 				lng: 72.80943
	// 			},
	// 			{
	// 				lat: 21.15666,
	// 				lng: 72.80941
	// 			},
	// 			{
	// 				lat: 21.15624,
	// 				lng: 72.80935
	// 			},
	// 			{
	// 				lat: 21.15594,
	// 				lng: 72.80932
	// 			},
	// 			{
	// 				lat: 21.15577,
	// 				lng: 72.80929
	// 			},
	// 			{
	// 				lat: 21.15577,
	// 				lng: 72.80929
	// 			},
	// 			{
	// 				lat: 21.1557,
	// 				lng: 72.80928
	// 			},
	// 			{
	// 				lat: 21.15487,
	// 				lng: 72.80917
	// 			},
	// 			{
	// 				lat: 21.15471,
	// 				lng: 72.80915
	// 			},
	// 			{
	// 				lat: 21.15445,
	// 				lng: 72.80905
	// 			},
	// 			{
	// 				lat: 21.15428,
	// 				lng: 72.80899
	// 			},
	// 			{
	// 				lat: 21.1541,
	// 				lng: 72.80889
	// 			},
	// 			{
	// 				lat: 21.15374,
	// 				lng: 72.8087
	// 			},
	// 			{
	// 				lat: 21.15325,
	// 				lng: 72.80843
	// 			},
	// 			{
	// 				lat: 21.15306,
	// 				lng: 72.80833
	// 			},
	// 			{
	// 				lat: 21.15099,
	// 				lng: 72.80721
	// 			},
	// 			{
	// 				lat: 21.15086,
	// 				lng: 72.80716
	// 			},
	// 			{
	// 				lat: 21.15079,
	// 				lng: 72.80712
	// 			},
	// 			{
	// 				lat: 21.15075,
	// 				lng: 72.80713
	// 			},
	// 			{
	// 				lat: 21.15072,
	// 				lng: 72.80713
	// 			},
	// 			{
	// 				lat: 21.15069,
	// 				lng: 72.80711
	// 			},
	// 			{
	// 				lat: 21.15066,
	// 				lng: 72.80709
	// 			},
	// 			{
	// 				lat: 21.15066,
	// 				lng: 72.80709
	// 			},
	// 			{
	// 				lat: 21.15064,
	// 				lng: 72.80706
	// 			},
	// 			{
	// 				lat: 21.15056,
	// 				lng: 72.80711
	// 			},
	// 			{
	// 				lat: 21.15023,
	// 				lng: 72.80724
	// 			},
	// 			{
	// 				lat: 21.14986,
	// 				lng: 72.80723
	// 			},
	// 			{
	// 				lat: 21.14951,
	// 				lng: 72.80707
	// 			},
	// 			{
	// 				lat: 21.14914,
	// 				lng: 72.80693
	// 			},
	// 			{
	// 				lat: 21.14881,
	// 				lng: 72.80681
	// 			},
	// 			{
	// 				lat: 21.14792,
	// 				lng: 72.80638
	// 			},
	// 			{
	// 				lat: 21.14673,
	// 				lng: 72.80581
	// 			},
	// 			{
	// 				lat: 21.14652,
	// 				lng: 72.8057
	// 			},
	// 			{
	// 				lat: 21.14625,
	// 				lng: 72.80554
	// 			},
	// 			{
	// 				lat: 21.14625,
	// 				lng: 72.80554
	// 			},
	// 			{
	// 				lat: 21.14622,
	// 				lng: 72.80556
	// 			},
	// 			{
	// 				lat: 21.14618,
	// 				lng: 72.80557
	// 			},
	// 			{
	// 				lat: 21.14615,
	// 				lng: 72.80556
	// 			},
	// 			{
	// 				lat: 21.14613,
	// 				lng: 72.80555
	// 			},
	// 			{
	// 				lat: 21.14611,
	// 				lng: 72.80554
	// 			},
	// 			{
	// 				lat: 21.14609,
	// 				lng: 72.80552
	// 			},
	// 			{
	// 				lat: 21.14609,
	// 				lng: 72.80552
	// 			},
	// 			{
	// 				lat: 21.14598,
	// 				lng: 72.80547
	// 			},
	// 			{
	// 				lat: 21.14529,
	// 				lng: 72.80515
	// 			},
	// 			{
	// 				lat: 21.14387,
	// 				lng: 72.80454
	// 			},
	// 			{
	// 				lat: 21.1428,
	// 				lng: 72.80408
	// 			},
	// 			{
	// 				lat: 21.14132,
	// 				lng: 72.80344
	// 			},
	// 			{
	// 				lat: 21.14017,
	// 				lng: 72.80294
	// 			},
	// 			{
	// 				lat: 21.13946,
	// 				lng: 72.80263
	// 			},
	// 			{
	// 				lat: 21.1393,
	// 				lng: 72.80259
	// 			},
	// 			{
	// 				lat: 21.1393,
	// 				lng: 72.80259
	// 			},
	// 			{
	// 				lat: 21.13917,
	// 				lng: 72.80271
	// 			},
	// 			{
	// 				lat: 21.13846,
	// 				lng: 72.80412
	// 			},
	// 			{
	// 				lat: 21.13834,
	// 				lng: 72.80433
	// 			},
	// 			{
	// 				lat: 21.13821,
	// 				lng: 72.80458
	// 			},
	// 			{
	// 				lat: 21.13816,
	// 				lng: 72.80466
	// 			},
	// 			{
	// 				lat: 21.13692,
	// 				lng: 72.80706
	// 			},
	// 			{
	// 				lat: 21.13633,
	// 				lng: 72.80857
	// 			},
	// 			{
	// 				lat: 21.13624,
	// 				lng: 72.80882
	// 			},
	// 			{
	// 				lat: 21.13567,
	// 				lng: 72.81029
	// 			},
	// 			{
	// 				lat: 21.13548,
	// 				lng: 72.81082
	// 			},
	// 			{
	// 				lat: 21.13522,
	// 				lng: 72.81137
	// 			},
	// 			{
	// 				lat: 21.13486,
	// 				lng: 72.81197
	// 			},
	// 			{
	// 				lat: 21.13439,
	// 				lng: 72.81274
	// 			},
	// 			{
	// 				lat: 21.13416,
	// 				lng: 72.81312
	// 			},
	// 			{
	// 				lat: 21.13376,
	// 				lng: 72.81379
	// 			},
	// 			{
	// 				lat: 21.13367,
	// 				lng: 72.81396
	// 			},
	// 			{
	// 				lat: 21.13301,
	// 				lng: 72.81518
	// 			},
	// 			{
	// 				lat: 21.13277,
	// 				lng: 72.81561
	// 			},
	// 			{
	// 				lat: 21.13178,
	// 				lng: 72.81735
	// 			},
	// 			{
	// 				lat: 21.13173,
	// 				lng: 72.81744
	// 			},
	// 			{
	// 				lat: 21.13171,
	// 				lng: 72.81747
	// 			},
	// 			{
	// 				lat: 21.13048,
	// 				lng: 72.81969
	// 			},
	// 			{
	// 				lat: 21.1302,
	// 				lng: 72.8202
	// 			},
	// 			{
	// 				lat: 21.12925,
	// 				lng: 72.82191
	// 			},
	// 			{
	// 				lat: 21.1292,
	// 				lng: 72.82199
	// 			},
	// 			{
	// 				lat: 21.12911,
	// 				lng: 72.82216
	// 			},
	// 			{
	// 				lat: 21.12899,
	// 				lng: 72.82236
	// 			},
	// 			{
	// 				lat: 21.12895,
	// 				lng: 72.82248
	// 			},
	// 			{
	// 				lat: 21.12894,
	// 				lng: 72.82254
	// 			},
	// 			{
	// 				lat: 21.12892,
	// 				lng: 72.82279
	// 			},
	// 			{
	// 				lat: 21.12889,
	// 				lng: 72.82444
	// 			},
	// 			{
	// 				lat: 21.12887,
	// 				lng: 72.82509
	// 			},
	// 			{
	// 				lat: 21.12887,
	// 				lng: 72.82544
	// 			},
	// 			{
	// 				lat: 21.12887,
	// 				lng: 72.82544
	// 			},
	// 			{
	// 				lat: 21.12973,
	// 				lng: 72.82542
	// 			},
	// 			{
	// 				lat: 21.12979,
	// 				lng: 72.82545
	// 			},
	// 			{
	// 				lat: 21.12983,
	// 				lng: 72.82551
	// 			},
	// 			{
	// 				lat: 21.1299,
	// 				lng: 72.82624
	// 			},
	// 			{
	// 				lat: 21.12989,
	// 				lng: 72.8263
	// 			},
	// 			{
	// 				lat: 21.12989,
	// 				lng: 72.8263
	// 			},
	// 			{
	// 				lat: 21.12994,
	// 				lng: 72.82642
	// 			},
	// 			{
	// 				lat: 21.13,
	// 				lng: 72.82646
	// 			},
	// 			{
	// 				lat: 21.13005,
	// 				lng: 72.82646
	// 			},
	// 			{
	// 				lat: 21.13014,
	// 				lng: 72.82645
	// 			},
	// 			{
	// 				lat: 21.13014,
	// 				lng: 72.82645
	// 			}
	// 		]
	// 	}),
	// 	headers: {
	// 		'Content-type': 'application/json'
	// 	}
	// });
	// const resp2 = await a.json();
	// console.log(resp2);
	console.log('+++++++++++++++++++++++++++++++++++++++++++++++');

	return {
		stateData: [swappedState],
		coordata: [swappedArea],
		predictedData: predictedData
	};
};
